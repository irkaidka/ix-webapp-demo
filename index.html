<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>DATAIX Подключение</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f1f3f9;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }
    .logo {
      margin-top: 20px;
      margin-bottom: 10px;
    }
    .logo img {
      height: 64px;
      max-width: 100%;
      object-fit: contain;
      display: block;
      margin: 0 auto;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      width: 95%;
      max-width: 520px;
    }
    h1 {
      color: #0d1c4b;
      font-size: 22px;
    }
    label {
      margin-top: 18px;
      display: block;
      font-weight: 600;
      font-size: 14px;
      color: #333;
    }
    select, input[type="text"], input[type="tel"], input[type="email"] {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      font-size: 14px;
      border: 1px solid #ccc;
      border-radius: 8px;
      box-sizing: border-box;
    }
    input[type="range"] {
      width: 100%;
      margin-top: 10px;
    }
    button {
      background-color: #1a49f5;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 12px;
      width: 100%;
      font-size: 16px;
      font-weight: 600;
      margin-top: 25px;
      cursor: pointer;
    }
    button:hover {
      background-color: #0d3bd3;
    }
    #bandwidthValue {
      margin-top: 10px;
      font-weight: bold;
      color: #0d1c4b;
    }
	#cityWarning { 
	  color: gray; 
      font-size: 12px; 
      margin-top: 8px; 
      display: none; /* Скрываем по умолчанию */
    }

    .page {
      display: none;
    }
    .visible {
      display: block;
    }
    .error {
      color: red;
      font-size: 14px;
      margin-top: 5px;
      display: none;
    }
	.helper-text {
      color: gray;
      font-size: 11px;
      margin-top: 5px;
	  margin-left: 10px;
    }
    .success {
      color: green;
      font-weight: bold;
      margin-top: 20px;
    }
  </style>
</head>
<body>
<div class="logo">
  <img src="https://i.postimg.cc/tJLCT5tM/logo.png" alt="DATAIX GlobalNet Logo">
</div>
<div class="container">

  <!-- Теперь page1 идет второй -->
  <div id="page1" class="page visible">
    <h1>Расчет стоимости подключения к DATAIX</h1>
    
    <label for="city">Город:</label>
    <select id="city">
      <option value="">Выберите город</option>
      <option value="Москва">Москва</option>
      <option value="Санкт-Петербург">Санкт-Петербург</option>
    </select>
	
	<div id="cityWarning" class="error" style="display: none;">Подключение в выбранном городе происходит по арендованным каналам связи, и его конечная стоимость может быть скорректирована.</div>

    <label for="dc">Дата-центр:</label>
    <select id="dc" disabled>
      <option value="">Сначала выберите город</option>
    </select>

    <label for="interface">Интерфейс подключения:</label>
    <select id="interface" disabled>
      <option value="">Сначала выберите дата-центр</option>
    </select>

    <div id="bandwidthBlock">
      <label for="bandwidth">Размер полосы (Гбит/с):</label>
      <input type="range" id="bandwidth" list="bandwidthList">
      <datalist id="bandwidthList"></datalist>
      <div id="bandwidthValue"></div>
    </div>

    <button id="submitBtn" disabled>Сохранить расчет</button>
	<div id="successMessage" class="success" style="display: none;">Запрос успешно отправлен. Наш специалист свяжется с вами в ближайшее время.</div>
  </div>
</div>

<script>
  const citySelect = document.getElementById("city");
  const dcSelect = document.getElementById("dc");
  const interfaceSelect = document.getElementById("interface");
  const bandwidth = document.getElementById("bandwidth");
  const bandwidthList = document.getElementById("bandwidthList");
  const bandwidthValue = document.getElementById("bandwidthValue");
  const submitBtn = document.getElementById("submitBtn");
  
  const page1 = document.getElementById("page1");
  const page2 = document.getElementById("page2");
  
  const pricingData = {
      1:16000, 2:30400, 3:43200, 4:54400, 5:64000, 6:71040, 7:75040, 8:76800, 9:79200, 
	  10:80000, 11:87472, 12:94848, 13:102128, 14:109312, 15:116400, 16:123392, 
	  17:130288, 18:137088, 19:143792, 20:150400, 30:211200, 40:262400, 50:304000, 
	  60:336000, 70:358400, 80:371200, 90:374400, 100:400000, 110:437888, 120:475392, 
	  130:512512, 140:549248, 150:585600, 160:621568, 170:657152, 180:692352, 
	  190:727168, 200:761600, 300:1089600, 400:1382400, 500:1640000, 
	  600:1862400, 700:2049600, 800:2201600, 900:2318400, 1000:2400000
    };  
  const interfaceOptions = ["1G", "10G", "100G", "400G"];
  
  const cityToDCs = {
      "Москва": ["М9 – Бутлерова, д. 7", "Dataline (Боровая) – Боровая, д. 7, стр. 10", "StoreData – Нижегородская, д. 32", "LinxDatacenter – ул. 8 Марта, д. 14", "I-Teco – Варшавское ш., 125, стр. 16", "DataSpace – Шарикоподшипниковская, 11, стр. 9", "DataPro – Авиамоторная, д. 69", "IXcellerate – Алтуфьевское ш., 33Г", "Dataline (Коровинское ш.) – Коровинское ш., д. 41"],
      "Санкт-Петербург": ["БМ18 – Большая Морская, д. 18", "Б57 – Боровая, д. 57", "К12 (Радуга) – Кантемировская, д. 12", "Selectel – Цветочная, д. 21", "LinxDatacenter – Репищева, д. 20А", "Miran – Пироговская набережная, д. 17", "IMAQLIQ – Седова, д. 11/б", "Ефимова 4 – ул. Ефимова, 4", "Ростелеком ДатаХаб – Трефолева, 29", "Ростелеком-ЦОД – Жукова, 43"]
    };

  let allowedBandwidths = [];

  function updateBandwidthList(maxGbps) {
    allowedBandwidths = Object.keys(pricingData).map(n => parseInt(n)).filter(n => n <= maxGbps);
    bandwidth.min = 0;
    bandwidth.max = allowedBandwidths.length - 1;
    bandwidth.value = 0;
    bandwidthList.innerHTML = "";
    allowedBandwidths.forEach((value, i) => {
      const option = document.createElement("option");
      option.value = i;
      option.label = value;
      bandwidthList.appendChild(option);
    });
    updatePrice();
  }

  function updatePrice() {
    const index = parseInt(bandwidth.value);
    const gb = allowedBandwidths[index];
    const cost = pricingData[gb];
    bandwidthValue.textContent = `Выбрано: ${gb} Гбит/с. Стоимость: ${cost.toLocaleString('ru-RU')} руб.`;
  }

function submitForm() {
  const tg = window.Telegram.WebApp;
  const index = parseInt(bandwidth.value);
  const gb = allowedBandwidths[index];
  const cost = pricingData[gb];
  const summary = `Выбор пользователя:\nГород: ${citySelect.value}\nДата-центр: ${dcSelect.value}\nИнтерфейс: ${interfaceSelect.value}G\nПолоса: ${gb} Гбит/с\nСтоимость: ${cost.toLocaleString('ru-RU')} руб.`;

  // Показываем сообщение об успешной отправке
  document.getElementById("successMessage").style.display = "block";

  // Отправка данных в Telegram
  tg.sendData("[WEBAPP] " + summary);

  // Закрытие веб-страницы через 5 секунд
  setTimeout(() => tg.close(), 5000);
}


  citySelect.addEventListener("change", () => {
    const city = citySelect.value;
    dcSelect.innerHTML = "<option value=''>Выберите дата-центр</option>";
    interfaceSelect.innerHTML = "<option value=''>Сначала выберите дата-центр</option>";
    dcSelect.disabled = interfaceSelect.disabled = true;
    submitBtn.disabled = true;
	
	const cityWarning = document.getElementById("cityWarning");
    if (city && city !== "Москва" && city !== "Санкт-Петербург") {
      cityWarning.style.display = "block";  // Показываем предупреждение
    } else {
      cityWarning.style.display = "none";   // Скрываем предупреждение
    }
	
    if (city && cityToDCs[city]) {
      cityToDCs[city].forEach(dc => {
        const option = document.createElement("option");
        option.value = dc;
        option.textContent = dc;
        dcSelect.appendChild(option);
      });
      dcSelect.disabled = false;
    }
  });

  dcSelect.addEventListener("change", () => {
    interfaceSelect.innerHTML = "<option value=''>Выберите интерфейс</option>";
    interfaceSelect.disabled = false;
    submitBtn.disabled = true;
    interfaceOptions.forEach(speed => {
      const option = document.createElement("option");
      option.value = speed.replace("G", "");
      option.textContent = speed;
      interfaceSelect.appendChild(option);
    });
  });

  interfaceSelect.addEventListener("change", () => {
    const selected = parseInt(interfaceSelect.value);
    if (selected) {
      updateBandwidthList(selected);
      submitBtn.disabled = false;
    } else {
      submitBtn.disabled = true;
    }
  });

  bandwidth.addEventListener("input", updatePrice);
  
  submitBtn.addEventListener("click", submitForm);
  
  Telegram.WebApp.ready();
</script>
</body>
</html>

